---
date:   2018-11-05 15:01:35 +0300
title:  '[In Progress] Project ABISMO'
description: í˜„ì¬ ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸ë¡œ, ë‹¤ì–‘í•œ ë¯¸ë‹ˆê²Œì„ê³¼ ìŠ¤í† ë¦¬ì— ì¤‘ì ì„ ë‘” 2D íƒ‘ë·° RPG ê²Œì„ì„ ê°œë°œí•˜ê³  ìˆìŠµë‹ˆë‹¤.
tags:   [Unity]
image:  '/images/abismo_thumbnail.png'
---

## í”„ë¡œì íŠ¸ ê°œìš”

Project ABISMO(ì´í•˜ ì•„ë¹„ì¦ˆëª¨)ëŠ” ì£¼ì¸ê³µì´ ì‘ì€ ë§ˆì„ë¡œ ì´ì‚¬í•˜ë©° í¼ì³ì§€ëŠ” ì´ì•¼ê¸°ë¥¼ ë‹´ì€ ê²Œì„ì…ë‹ˆë‹¤. í”Œë ˆì´ì–´ëŠ” ë§ˆì„ì„ íƒí—˜í•˜ë©° ìˆ¨ê²¨ì§„ ì´ì•¼ê¸°ë¥¼ ì°¾ì•„ë‚´ê±°ë‚˜ ì£¼ë¯¼ë“¤ê³¼ êµë¥˜í•  ìˆ˜ ìˆê³ , ë‚šì‹œ ë˜ëŠ” ìš”ë¦¬ ë“±ì˜ ë‹¤ì–‘í•œ ì»¨í…ì¸ ë¥¼ ì¦ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

***

## ì§ì±… ë° ë‹´ë‹¹ ì—…ë¬´

ê°œë°œ íŒ€ì¥ì„ ë§¡ì•„ ê°œë°œ ì „ë°˜ì„ ê´€ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤. ìƒì„¸í•œ ë‹´ë‹¹ ì—…ë¬´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

- ê²Œì„ ì‹œìŠ¤í…œ ì„¤ê³„ ë° êµ¬í˜„

- ê°œë°œìš© íˆ´ ì œì‘ ë° ìœ ì§€ë³´ìˆ˜

- íƒ€ ë¶€ì„œì™€ì˜ íšŒì˜ ì§„í–‰ ë° í˜‘ì—…

- ì—…ë¬´ ë¶„ë‹´

***

## ì‘ì—…ë¬¼ ì˜ˆì‹œ

#### 1. ê²Œì„ ì‹œìŠ¤í…œ êµ¬í˜„

ì•„ë˜ ì½”ë“œ ë¸”ëŸ­ì€ í€˜ìŠ¤íŠ¸ ì‹œìŠ¤í…œì„ êµ¬í˜„í•˜ê¸° ìœ„í•œ QuestManagerì˜ ì½”ë“œì…ë‹ˆë‹¤. QuestManagerëŠ” Singleton íŒ¨í„´ì„ ì‚¬ìš©í•˜ê³ , ê²Œì„ ì‹œì‘ ì‹œ í€˜ìŠ¤íŠ¸ ì •ë³´ë¥¼ íŒŒì‹±í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. 

<details>
<summary>ì ‘ê¸°/í¼ì¹˜ê¸°</summary>
<div markdown="1">

```cs
using System;
using System.Collections.Generic;
using Newtonsoft.Json;
using UnityEngine;

namespace Quest
{
	public class QuestManager : MonoBehaviour
	{
		public static QuestManager instance;

		/// <summary>
		/// Contains every quest data.
		/// Use index of quest as key.
		/// </summary>
		private QuestNode[] questNodes;

		public void Initialize()
		{
			if (instance == null)
			{
				instance = this;
				DontDestroyOnLoad(gameObject);
			}
			else if (instance != this)
			{
				Destroy(gameObject);
			}

			LoadQuests();
		}

		/// <summary>
		/// Called once at start of game. Load and parse Quest.json in Resource folder.
		/// </summary>
		/// <returns>
		/// Returns <c>true</c> if the quests were successfully loaded and parsed; 
		/// otherwise, <c>false</c>.
		/// </returns>
		private bool LoadQuests()
		{
			try
			{
				// Load JSON file from the Resources folder
				TextAsset jsonFile = Resources.Load<TextAsset>("Quest");

				if (jsonFile == null)
				{
					Debug.LogError("Quest.json file not found in Resources folder!");
					return false;
				}

				// Parse JSON into QuestJsonData and extract quests array
				QuestJsonData questData = JsonConvert.DeserializeObject<QuestJsonData>(jsonFile.text);

				if (questData == null || questData.Quests == null || questData.Quests.Length == 0)
				{
					Debug.LogError("Failed to parse Quest.json or no quests defined!");
					return false;
				}

				questNodes = questData.Quests;

				Debug.Log($"Successfully loaded {questNodes.Length} quests.");
				return true;
			}
			catch (Exception ex)
			{
				Debug.LogError($"Error loading Quest.json: {ex.Message}");
				return false;
			}
		}

		public class QuestNode
		{
			[JsonProperty("index")]
			public int index { get; private set; }

			[JsonProperty("condition")]
			public QuestCondition condition { get; private set; }

			[JsonProperty("info")]
			public QuestInfo info { get; private set; }

			[JsonProperty("stages")]
			public List<QuestStage> stages { get; private set; }

			[JsonProperty("children")]
			public List<QuestNode> children { get; private set; }

			public QuestNode(int index, QuestCondition condition, QuestInfo info, List<QuestStage> stages, List<QuestNode> children)
			{
				this.index = index;
				this.condition = condition;
				this.info = info;
				this.stages = stages ?? new List<QuestStage>();
				this.children = children ?? new List<QuestNode>();
			}
		}

		public class QuestCondition
		{
			/// <summary>
			/// Indices of quest must be cleared to receive this quest
			/// </summary>
			[JsonProperty("parentIndices")]
			public List<int> ParentIndices { get; private set; }

			/// <summary>
			/// Number of days to wait until the QuestManager marks this quest
			/// as Acceptable after the condition is met
			/// </summary>
			[JsonProperty("delayToBeAcceptable")]
			public int DelayToBeAcceptable { get; private set; }

			public QuestCondition(List<int> parentIndices, int delayToBeAcceptable)
			{
				this.ParentIndices = parentIndices ?? new List<int>();
				this.DelayToBeAcceptable = delayToBeAcceptable;
			}
		}

		public class QuestInfo
		{
			[JsonProperty("rewardItems")]
			public List<ItemInfo> RewardItems { get; private set; }

			[JsonProperty("rewardLenbo")]
			public int RewardLenbo { get; private set; }

			[JsonProperty("name")]
			public string Name { get; private set; }

			[JsonProperty("description")]
			public string Description { get; private set; }

			public QuestInfo(List<ItemInfo> rewardItems, int rewardLenbo, string name, string description)
			{
				this.RewardItems = rewardItems ?? new List<ItemInfo>();
				this.RewardLenbo = rewardLenbo;
				this.Name = name;
				this.Description = description;
			}
		}

		public class QuestStage
		{
			[JsonProperty("index")]
			public int Index { get; private set; }

			[JsonProperty("description")]
			public string Description { get; private set; }

			/// <summary>
			/// List of (NPC Code, Dialogue Index)
			/// </summary>
			[JsonProperty("dialogues")]
			public List<DialogueInfo> Dialogues { get; private set; }

			/// <summary>
			/// If this condition is satisfied, stage is cleared
			/// </summary>
			[JsonProperty("condition")]
			public QuestStageCondition Condition { get; private set; }

			/// <summary>
			/// When a stage is cleared, every child will be activated
			/// </summary>
			[JsonProperty("children")]
			public List<int> Children { get; private set; }

			/// <summary>
			/// Index of event which will be called at start of stage
			/// </summary>
			[JsonProperty("eventIndex_OnStart")]
			public int EventIndex_OnStart { get; private set; }

			/// <summary>
			/// Index of event which will be called at end of stage
			/// </summary>
			[JsonProperty("eventIndex_OnEnd")]
			public int EventIndex_OnEnd { get; private set; }

			public QuestStage(int index, string description, List<DialogueInfo> dialogues,
							  QuestStageCondition condition, List<int> children,
							  int eventIndexOnStart, int eventIndexOnEnd)
			{
				this.Index = index;
				this.Description = description;
				this.Dialogues = dialogues ?? new List<DialogueInfo>();
				this.Condition = condition;
				this.Children = children ?? new List<int>();
				this.EventIndex_OnStart = eventIndexOnStart;
				this.EventIndex_OnEnd = eventIndexOnEnd;
			}
		}

		public class QuestStageCondition
		{
			[JsonProperty("itemConditions")]
			public List<ItemInfo> ItemConditions { get; private set; }

			[JsonProperty("dialogueConditions")]
			public List<int> DialogueConditions { get; private set; }

			public QuestStageCondition(List<ItemInfo> itemConditions, List<int> dialogueConditions)
			{
				this.ItemConditions = itemConditions ?? new List<ItemInfo>();
				this.DialogueConditions = dialogueConditions ?? new List<int>();
			}
		}

		public struct ItemInfo
		{
			[JsonProperty("itemCode")]
			public int ItemCode { get; private set; }

			[JsonProperty("itemAmount")]
			public int ItemAmount { get; private set; }

			public ItemInfo(int itemCode, int itemAmount)
			{
				this.ItemCode = itemCode;
				this.ItemAmount = itemAmount;
			}
		}

		public struct DialogueInfo
		{
			[JsonProperty("npcCode")]
			public int NpcCode { get; private set; }

			[JsonProperty("dialogueIndex")]
			public int DialogueIndex { get; private set; }

			public DialogueInfo(int npcCode, int dialogueIndex)
			{
				this.NpcCode = npcCode;
				this.DialogueIndex = dialogueIndex;
			}
		}

		public class QuestJsonData
		{
			public QuestNode[] Quests { get; set; }
		}

	}
}
```

</div>
</details>

<br>

#### 2. ê°œë°œìš© íˆ´ ì œì‘

ì‹œë‚˜ë¦¬ì˜¤ íŒ€ì´ íš¨ìœ¨ì ìœ¼ë¡œ í€˜ìŠ¤íŠ¸ ì •ë³´ë¥¼ ê¸°ì…í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ í€˜ìŠ¤íŠ¸ ê·¸ë˜í”„ ì—ë””í„°ë¥¼ ì œì‘í•˜ì˜€ìŠµë‹ˆë‹¤.

  ![RL](/images/datagraph_thumbnail.png){: .center-img width="500" }


í€˜ìŠ¤íŠ¸ ê·¸ë˜í”„ ì—ë””í„°ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” ğŸ”—[ì´ ë§í¬](../../personalprojects/customgrapheditor)ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

***

## ì¸ê²Œì„ í™”ë©´

ê°œë°œ ì¤‘ì¸ ì¸ê²Œì„ í™”ë©´ì˜ ì˜ˆì‹œì…ë‹ˆë‹¤.

![RL](/images/abismo_thumbnail.png){: width="1200" height="900"}





